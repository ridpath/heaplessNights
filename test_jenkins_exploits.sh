#!/bin/bash
cd /home/over/projects/JenkinsBreaker
export PATH="/home/over/.local/bin:$PATH"

echo "=== Creating standalone venv for JenkinsBreaker ==="
python3 -m venv /home/over/projects/JenkinsBreaker/.venv_jenkinsbreaker

echo ""
echo "=== Installing dependencies in venv ==="
/home/over/projects/JenkinsBreaker/.venv_jenkinsbreaker/bin/pip install --break-system-packages requests pycryptodome jinja2 tabulate rich dnspython pyjwt websockets fastapi uvicorn -q

echo ""
echo "=== Verifying Jenkins Lab is running ==="
docker ps | grep jenkins

echo ""
echo "=== Waiting additional 15 seconds for Jenkins to fully initialize ==="
sleep 15

echo ""
echo "=== Testing JenkinsBreaker --list-cves ==="
/home/over/projects/JenkinsBreaker/.venv_jenkinsbreaker/bin/python JenkinsBreaker.py --url http://localhost:8080 --list-cves 2>&1 | head -80

echo ""
echo "=== Jenkins Lab is ready for testing ==="
echo "To manually test exploits:"
echo "/home/over/projects/JenkinsBreaker/.venv_jenkinsbreaker/bin/python JenkinsBreaker.py --url http://localhost:8080 --auto --lhost 127.0.0.1 --lport 9001"
